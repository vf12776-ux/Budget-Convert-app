<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget & Convert</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background: linear-gradient(to bottom, #1e3a8a, #3b82f6); }
        .container { max-width: 600px; margin: 40px auto; background: white; padding: 24px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        input, select, button { transition: all 0.3s; }
        input:focus, select:focus { outline: none; border-color: #3b82f6; box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
        button:hover { transform: scale(1.05); }
        #history { max-height: 100px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-2xl font-bold text-center mb-6 text-gray-800">Budget & Convert</h1>
        <div class="flex justify-center mb-4">
            <button onclick="showTab('converter')" class="px-4 py-2 bg-blue-600 text-white rounded-l hover:bg-blue-700">Конвертер</button>
            <button onclick="showTab('budget')" class="px-4 py-2 bg-blue-600 text-white rounded-r hover:bg-blue-700">Бюджет</button>
        </div>

        <!-- Converter Tab -->
        <div id="converter" class="tab-content active">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Конвертер единиц</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Значение:</label>
                <input id="value" type="number" placeholder="100" class="w-full p-2 border rounded-md">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Из:</label>
                <select id="fromUnit" class="w-full p-2 border rounded-md">
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="m">Метры</option>
                    <option value="ft">Футы</option>
                    <option value="kg">Килограммы</option>
                    <option value="lb">Фунты</option>
                    <option value="km">Километры</option>
                    <option value="mi">Мили</option>
                    <option value="C">°C</option>
                    <option value="F">°F</option>
                </select>
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">В:</label>
                <select id="toUnit" class="w-full p-2 border rounded-md">
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                    <option value="m">Метры</option>
                    <option value="ft">Футы</option>
                    <option value="kg">Килограммы</option>
                    <option value="lb">Фунты</option>
                    <option value="km">Километры</option>
                    <option value="mi">Мили</option>
                    <option value="C">°C</option>
                    <option value="F">°F</option>
                </select>
            </div>
            <button onclick="convert()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Конвертировать</button>
            <p id="result" class="mt-4 font-semibold text-gray-800"></p>
            <div id="history" class="mt-4 text-sm text-gray-600"></div>
        </div>

        <!-- Budget Tab -->
        <div id="budget" class="tab-content">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">Калькулятор бюджета</h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Доходы (через пробел):</label>
                <input id="incomes" type="text" placeholder="50000 20000" class="w-full p-2 border rounded-md">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Расходы (через пробел):</label>
                <input id="expenses" type="text" placeholder="30000 10000" class="w-full p-2 border rounded-md">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700">Валюта:</label>
                <select id="currency" class="w-full p-2 border rounded-md">
                    <option value="RUB">RUB</option>
                    <option value="USD">USD</option>
                </select>
            </div>
            <button onclick="calculateBudget()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">Рассчитать</button>
            <div id="budgetResult" class="mt-4 font-semibold text-gray-800"></div>
            <canvas id="budgetChart" class="mt-4" height="100"></canvas>
        </div>
    </div>

    <script>
        // Tab switching
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
        }

        // Converter
        let history = JSON.parse(localStorage.getItem('convertHistory')) || [];
        function convert() {
            const value = parseFloat(document.getElementById('value').value);
            const fromUnit = document.getElementById('fromUnit').value;
            const toUnit = document.getElementById('toUnit').value;
            let result;

            if (isNaN(value)) {
                document.getElementById('result').innerText = 'Введите число!';
                return;
            }

            const rates = {
                'RUB-USD': 1 / 100,
                'USD-RUB': 100,
                'm-ft': 3.28084,
                'ft-m': 1 / 3.28084,
                'kg-lb': 2.20462,
                'lb-kg': 1 / 2.20462,
                'km-mi': 0.621371,
                'mi-km': 1 / 0.621371,
                'C-F': (v) => (v * 9/5) + 32,
                'F-C': (v) => (v - 32) * 5/9
            };

            const key = `${fromUnit}-${toUnit}`;
            result = key in rates ? (typeof rates[key] === 'function' ? rates[key](value) : value * rates[key]) : value;

            const resultText = `${value} ${fromUnit} = ${result.toFixed(2)} ${toUnit}`;
            document.getElementById('result').innerText = resultText;

            history.unshift(resultText);
            if (history.length > 5) history.pop();
            localStorage.setItem('convertHistory', JSON.stringify(history));
            document.getElementById('history').innerHTML = '<strong>История:</strong><br>' + history.join('<br>');
        }

        // Budget
        function calculateBudget() {
            const incomes = document.getElementById('incomes').value.split(' ').map(Number).filter(n => !isNaN(n));
            const expenses = document.getElementById('expenses').value.split(' ').map(Number).filter(n => !isNaN(n));
            const currency = document.getElementById('currency').value;
            const totalIncome = incomes.reduce((sum, val) => sum + val, 0);
            const totalExpense = expenses.reduce((sum, val) => sum + val, 0);
            const balance = totalIncome - totalExpense;
            const advice = balance > 0 ? 'Всё ок, можешь тратить!' : 'Пора экономить!';

            const rate = currency === 'USD' ? 1 / 100 : 1;
            const displayIncome = (totalIncome * rate).toFixed(2);
            const displayExpense = (totalExpense * rate).toFixed(2);
            const displayBalance = (balance * rate).toFixed(2);

            document.getElementById('budgetResult').innerHTML = `
                <p><strong>Доходы:</strong> ${displayIncome} ${currency}</p>
                <p><strong>Расходы:</strong> ${displayExpense} ${currency}</p>
                <p><strong>Баланс:</strong> ${displayBalance} ${currency}</p>
                <p><strong>Совет:</strong> ${advice}</p>
            `;

            const ctx = document.getElementById('budgetChart').getContext('2d');
            if (window.budgetChart) window.budgetChart.destroy();
            window.budgetChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Доходы', 'Расходы', 'Баланс'],
                    datasets: [{
                        label: `Бюджет (${currency})`,
                        data: [displayIncome, displayExpense, displayBalance],
                        backgroundColor: ['#34d399', '#f87171', balance >= 0 ? '#3b82f6' : '#ef4444'],
                        borderColor: ['#059669', '#b91c1c', balance >= 0 ? '#1d4ed8' : '#b91c1c'],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: { y: { beginAtZero: true } },
                    plugins: { legend: { display: false } }
                }
            });
        }
    </script>
</body>
</html>